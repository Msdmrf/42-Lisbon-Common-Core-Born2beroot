# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Evaluation.txt                                     :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: migusant <migusant@student.42lisboa.com    +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2025/05/05 15:47:11 by migusant          #+#    #+#              #
#    Updated: 2025/05/07 13:01:16 by migusant         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #



The project involves creating and configuring a virtual machine following strict rules. 
The evaluated person will need to assist you during the defense. 
Make sure all the following points are respected.



General Guidelines:

  During the defense, as soon as you need help to verify a point, the evaluated person must assist you:
    1. As a precaution, you may duplicate the original virtual machine to keep a copy.
    2. Check that the "signature.txt" file is present at the root of the cloned repository.
    3. Ensure that the signature contained in "signature.txt" matches that of the ".vdi" file of the virtual machine being evaluated.
    A simple diff should allow you to compare the two signatures. If needed, ask the evaluated person where their ".vdi" file is located.
      Path: 
        /home/migusant/sgoinfre/Born2beroot/Born2beroot.vdi
      Diff Command: 
        diff <(sha1sum /home/migusant/sgoinfre/Born2beroot/Born2beroot.vdi | cut -d' ' -f1) <(cat signature.txt)
      Diff Output:
        If the signatures match, the diff command will produce no output.
        If the signatures do not match, diff will show the lines that differ (i.e., the two different hashes).
    4. Launch the cloned virtual machine to be evaluated.
  If something does not work as expected or the two signatures differ, the evaluation stops here.



Project Overview:

  The evaluated person must simply explain:
    1. The basic functioning of their virtual machine.
      "My virtual machine runs using VirtualBox on my host computer. The hypervisor creates a simulated hardware environment by allocating 
      resources like CPU cores, RAM, and disk space from the host machine. Inside this isolated environment, I have installed and configured 
      the Debian operating system. It functions like a separate computer, but it's entirely contained within the hypervisor software on my host."
    2. Their choice of operating system.
      "I chose Debian primarily because it's the required operating system for the Born2beroot project at 42. Additionally, Debian is well-regarded 
      for its stability, extensive software repositories managed by apt, strong security focus, and its widespread use in server environments. This 
      makes it an excellent platform for learning Linux system administration fundamentals."
    3. The basic differences between Rocky and Debian.
      "The main differences lie in their origins and package management. Rocky Linux is derived from Red Hat Enterprise Linux (RHEL) source code, 
      aiming for binary compatibility with RHEL. It uses the RPM package format and the dnf package manager. Debian is an independent, 
      community-driven project and the base for many other distributions like Ubuntu. It uses the DEB package format and the apt family of package 
      managers (apt, apt-get, aptitude). They also have different philosophies regarding software inclusion and release cycles."
    4. The benefits of virtual machines.
      "Virtual machines offer several key benefits:
        Isolation: They provide a sandboxed environment, separating the guest OS from the host. This is great for testing software or configurations 
        without risking the host system.
        Resource Consolidation: Multiple VMs can run on a single physical machine, making efficient use of hardware resources.
        Snapshots: You can save the state of a VM at any point (a snapshot) and easily revert to it if something goes wrong, which is invaluable for 
        experimentation.
        Testing & Development: VMs allow easy creation of specific, reproducible environments for development or testing software across different OS 
        versions or configurations.
        Portability: VM images can often be moved and run on different physical computers."
    5. If the chosen operating system is Rocky, they must explain what SELinux and DNF are.
      "SELinux, which stands for Security-Enhanced Linux, is a Linux kernel security module that provides a mechanism for supporting Mandatory Access 
      Control (MAC) security policies. Unlike standard Linux Discretionary Access Control (DAC) which relies on user/group ownership and permissions 
      (like rwx), SELinux enforces rules based on policies that define what actions specific processes (subjects) can perform on specific system resources 
      (objects) like files, devices, or network ports. It works by assigning security labels to both subjects and objects. Even if standard file permissions 
      would allow an action, SELinux can block it if the policy doesn't explicitly permit it. This significantly enhances security by limiting the potential 
      damage from compromised processes, preventing privilege escalation, and enforcing fine-grained access control."
      "DNF (Dandified YUM) is the default high-level package manager for Rocky Linux and other modern RPM-based distributions like Fedora and RHEL 8+. It's 
      the successor to yum. DNF is used to install, update, remove, and otherwise manage software packages (in .rpm format) on the system. It automatically 
      handles dependencies, meaning when you install a package, DNF ensures all other required packages are also installed. Compared to yum, DNF offers 
      improved performance, better dependency resolution using the libsolv library, and a more predictable command-line interface."
    6. If the chosen operating system is Debian, they must explain the difference between aptitude and apt, and what APPArmor is. 
      "Both apt and aptitude are high-level package management tools for Debian systems, acting as front-ends to the lower-level dpkg tool.
      apt is the more modern and commonly used command-line interface. It provides essential commands like install, remove, update, upgrade in a 
      straightforward manner.
      aptitude offers both a command-line interface and an interactive text-based UI. Its main advantage is often considered its more sophisticated 
      dependency resolver. 
      When conflicts arise, aptitude can sometimes suggest multiple resolution strategies, whereas apt might be more direct. aptitude also keeps a slightly 
      more detailed log of which packages were installed automatically versus explicitly."
    7. During the defense, a script must display information every 10 minutes. Its operation will be checked in detail later.
      "I have created a monitoring script (monitoring.sh) located at /etc/cron.d/monitoring.sh. I have configured a cron job that executes this script every 
      10 minutes. The script's output, containing various system metrics, is broadcast to all logged-in user terminals using wall. We can check the script's 
      content and the crontab entry later in the evaluation."
  If the explanations are not clear, the evaluation stops here.



Simple Configuration

  As soon as you need help to verify a point, the evaluated person must be able to assist you:
    1. Verify that the machine does not have a graphical environment at startup. A password will be requested before any connection attempt on this machine. 
    Log in with a non-root user. Verify that the chosen password respects the rules imposed in the subject.
      Check User Password: (M1gusant42us3r)
        Your password must be at least 10 characters long. It must contain an uppercase letter, a lowercase letter, and a number. Also, it must not contain 
        more than 3 consecutive identical characters. The password must not include the name of the user.
      Check User Password Extra Policies Command:
        Your password has to expire every 30 days. The minimum number of days allowed before the modification of a password will be set to 2. The user has 
        to receive a warning message 7 days before their password expires.
          sudo chage -l migusant
      Check Log in with Non-Root User Command:
        whoami
      Expected Output:
        migusant
      Check Default Target for System Boot Command:
        systemctl get-default
      Expected Output:
        If we get multi-user.target, it indicates the system boots into a command-line environment.
        If we get graphical.target, it indicates the system is configured to boot into a GUI login manager and desktop. If there is no GUI to boot to, it will boot to a command-line environment.
      Check Graphical Environment Command:
        dpkg -l | grep -E "xserver|gnome|kde|xfce|lxde"
        or
        ls /usr/bin | grep -E "startx|Xorg"
      Expected Output:
        If these commands return results, it means graphical packages are indeed installed.
    2. Then, with the help of the evaluator, make sure that:
      2.1 The chosen operating system is indeed Debian or Rocky.
        OS Command:
          cat /etc/os-release
        Expected Output:
          The output should contain lines clearly identifying the OS as "Debian".
      2.2 The UFW service is properly launched.
        UFW Status Command:
          systemctl status ufw
        Expected Output:
          Active: active (running)
      2.3 The SSH service is properly launched. 
        SSH Service Command:
          systemctl status sshd
        Expected Output:
          Active: active (running)
          Check the port to verify it's listening on the port specified in the subject (e.g., 4242) and not the default port 22.
  If something does not work as expected or is not clearly explained, the evaluation stops here.



User

  As soon as you need help to verify a point, the evaluated person must be able to assist you:
    1. The subject requires that a user with the login name of the evaluated person be present on the virtual machine. Verify that this user has been added 
    and that they belong to the "sudo" and "user42" groups.
      Check if Belongs Command:
        id migusant or groups migusant
      Expected Output:
        Look for migusant's UID/GID information and verify that both sudo and user42 are listed in the groups= section of the output.
    2. Ensure the rules imposed in the subject concerning the password policy have been implemented by following the steps below.
      2.1 First, create a new user. Assign them a password of your choice, respecting the subject's rules.
        Create user Command:
          sudo adduser testuser
        Create password Command (if not prompted automatically):
          sudo passwd testuser
            If the policy is correctly implemented (e.g., via PAM modules like pam_pwquality), the system should:
              Reject passwords that don't have at lease 10 characters.
              Reject passwords that don't include at lease one uppercase.
              Reject passwords that don't include at lease one lowercase.
              Reject passwords that don't include at lease one digit.
              Reject passwords that include username.
            Eventually accept a password that does meet the criteria.
      2.2 The evaluated person must now explain how they were able to implement the requested rules on their virtual machine.
        "To implement the password policy, I needed to do two different things:
          Password Aging/Expiration: I edited the /etc/login.defs file. Specifically, I set parameters like PASS_MAX_DAYS (e.g., to 30 or 90, as required) 
          to force password changes, PASS_MIN_DAYS (e.g., to 2) to prevent immediate changes, and PASS_WARN_AGE (e.g., to 7) to warn users before expiration.
          Password Strength/Complexity: I installed the libpam-pwquality package (if not present) and configured it by editing the /etc/pam.d/common-password 
          file. I added or modified the line for pam_pwquality.so to include options specified in the subject, such as retry=3 (limit password attempts), 
          minlen=10 (minimum length), dcredit=-1 (at least one digit), ucredit=-1 (at least one uppercase), lcredit=-1 (at least one lowercase), ocredit=-1 
          (at least one special character), and potentially difok=7 (must differ from old password by 7 characters) and reject_username (prevent using username in password)."
  If there is any problem, the evaluation stops here.
    3. Now that you have a new user, ask the evaluated person to create a group named "evaluating" in front of you and assign it to this user.
      Create group Command:
        sudo addgroup evaluating
      Add user to group Command:
        sudo usermod -aG evaluating testuser
      Check if Belongs Command:
        id testuser or groups testuser
      Expected Output:
        Look for testuser's UID/GID information and verify that evaluating is listed in the groups= section of the output.
    4. To finish, ask the evaluated person to explain the purpose of this password policy, as well as the advantages and disadvantages of its implementation. Of course, 
    answering that it is because the subject requires it does not count.
      "The primary purpose of this password policy isn't just because the subject requires it, but to enhance the overall security of the system. It aims to make user accounts 
      significantly harder to compromise through common attacks like brute-forcing (guessing passwords) or using credentials found in breaches (password reuse).
      Some advantages are:
        Increased Security: Complex passwords are much harder to guess or crack. Regular expiration limits the time window an attacker has if they do obtain a password.
        Reduced Risk: Prevents users from using weak, easily guessable passwords or reusing the same password across multiple services.
        Compliance: Helps meet security best practices and potential compliance requirements.
        Accountability: Enforces a minimum standard of security hygiene across all users.
      Some disadvantages are:
        User Inconvenience: Remembering complex passwords and changing them frequently can be frustrating for users.
        Insecure Practices: May lead users to write passwords down (often insecurely) or use predictable patterns to meet complexity rules.
        Potential Lockouts/Helpdesk Load: Users might forget passwords more often, potentially increasing support requests for resets.
        Complexity != Strength: A policy can enforce complexity, but users might still choose fundamentally weak passwords that meet the letter but not the spirit of the rules 
        (e.g., Password123!). It's a balance betweenChange this hostname by replacing the login with yours, then restart the machine. If upon restarting, the hostname has not been updated, the evaluation stops here. technical enforcement and user education."
  If something does not work as expected or is not clearly explained, the evaluation stops here.



Hostname and Partitions

  As soon as you need help to verify a point, the evaluated person must be able to assist you:
    1. Verify that the hostname of the machine is formatted as follows: login42 (login of the evaluated person).
      Check Command:
        hostname
      Expected OUtput:
        migusant42
    2. Change this hostname by replacing the login with yours, then restart the machine. If upon restarting, the hostname has not been updated, the evaluation stops here.
      Wrong change host Command: (This will only change the hostname for the current session. However, this is not persistent across reboots. To make this change persistent see next step.)
        hostname testevaluator
      Check Command:
        hostname
      Right change host Process:
         nano /etc/hostname (change the contents of the file to match the new hostname, for example, to testevaluator)
         nano /etc/hosts    (additionally, update the /etc/hosts file to reflect the new hostname: replace any occurrences of the old hostname with the new one, for example, 127.0.1.1 testevaluator)
         sudo reboot        (restart the machine for the changes to take place)
       Check Command:
        hostname
     3. You can now restore the original hostname of the machine.
       Right change host Process:
        nano /etc/hostname (change the contents of the file to match the old hostname, migusant42)
        nano /etc/hosts    (additionally, update the /etc/hosts file to reflect the new hostname: replace any occurrences of the old hostname with the new one, 127.0.1.1 migusant42)
        sudo reboot        (restart the machine for the changes to take place)
       Check Command:
        hostname
     4. The evaluator will ask you to display the partitions of your virtual machine. To do this, use the following command:
       Check partitions Command:
        lsblk
      Expected Outputs:
        You must have at least 2 encrypted partitions using LVM (check the number of lines below "sdaX_crypt"). Check the subject for an example of the expected partitioning.
        If the evaluatee did the BONUS part, check the example of the expected partitioning from the Bonus Part.
    5. Explanation of LVM:
      "LVM stands for Logical Volume Management. It’s a system for managing disk storage that abstracts the physical layout of the disks. Instead of working directly with physical 
      partitions, LVM introduces an extra layer. Here’s how it works:
      Physical Volumes (PVs): These are the actual physical hard drives or partitions (e.g., /dev/sda2).
      Volume Groups (VGs): These are created by combining one or more physical volumes into a single pool of storage.
      Logical Volumes (LVs): These are created from the volume group and act like virtual partitions. You can format and mount them just like normal partitions.
      For example, you might create a volume group named vg-root and then create logical volumes like lv-root (for /) and lv-swap (for swap space).
      Benefits of LVM:
      Flexibility: You can resize logical volumes dynamically without needing to unmount them (e.g., extend your /home volume if it’s running out of space).
      Snapshots: LVM allows you to create snapshots of logical volumes, which are useful for backups or testing.
      Disk Management: You can add more physical volumes (e.g., new hard drives) to an existing volume group, effectively increasing storage without downtime.
      Simplified Partitioning: LVM allows you to create partitions on-the-fly without worrying about the fixed sizes of traditional partitions."
  If something does not work as expected or is not clearly explained, the evaluation stops here.



SUDO

  As soon as you need help to verify a point, the evaluated person must be able to assist you:
    1. Verify that the "sudo" program is indeed installed on the virtual machine.
      Check Sudo Command:
        sudo --version
      Expected Output:
        Sudo version 1.9.x
    2. Assign your new user (for example, the testuser) to the sudo group:
      Add to Group Command:
        sudo usermod -aG sudo testuser
      Check if Belongs Command:
        id testuser or groups testuser
      Expected Output:
        Look for testuser's UID/GID information and verify that sudo is listed in the groups= section of the output. 
    3. Explain the Purpose and show an example operation of sudo
      "sudo stands for 'superuser do' and allows a user to execute commands with elevated privileges (as the root user). It’s a safer alternative to directly logging 
      in as root because it restricts access and logs all commands executed. By requiring explicit permission and authentication, it minimizes the risk of accidental 
      system-wide changes or malicious actions.
      For example:
      As a user, to update and upgrade the system, you need to use sudo: sudo apt update && sudo apt upgrade.
      As a user, to edit a system file, you need to use sudo: sudo nano /etc/hostname.
      As a user, restart a system service, you need to use sudo: sudo systemctl restart ssh."
    4. Demonstrate the implementation of the rules imposed by the subject, that are present in the "sudoers" file:
      Check sudoers file command:
        sudo visudo
      Defaults        env_reset (clears the environment variables except for a safe default set when running commands with sudo)
        Command:
          Run env, and then sudo env
        Expected Output:
          Observe that most environment variables (like PATH) were reset to a secure default when running sudo env
      Defaults        mail_badpass (sends an email to the system administrator if a user enters an incorrect password for sudo)
        This service isn't installed by default, so you should install it, or defend why don't you use it.
        TO INSTALL IT, CHECK THE mail_logging.sh SCRIPT!
          Commands for mailutils:
            dpkg -l | grep mailutils (if it doesn't return anything, we need to install mailutils)
            sudo apt update
            sudo apt install mailutils -y
          Commands for postfix:
            The mailutils package usually installs Postfix as a dependency, but you'll want to ensure that it is installed and running.
            dpkg -l | grep postfix (if it doesn't return anything, we need to install postfix)
            sudo apt update
            sudo apt install postfix -y
              Select "<OK>"
              Select "Local Only"
              Input your "System mail name: migusant42" and select <OK>
            sudo systemctl start postfix
            sudo systemctl enable postfix
            sudo systemctl status postfix (and check if it is active and running)
            sudo systemctl restart postfix  (to apply new configurations)
          Commands for rsyslog:
            dpkg -l | grep rsyslog (if it doesn't return anything, we need to install rsyslog)
            sudo apt update
            sudo apt install rsyslog -y
            sudo systemctl start rsyslog
            sudo systemctl enable rsyslog
            sudo systemctl status rsyslog (and check if it is active and running)
            sudo systemctl restart rsyslog (to apply new configurations)
            sudo nano /etc/rsyslog.d/mail.conf (open or create the configuration file for mail logs)
            mail.*                        -/var/log/mail.log (add the following line to ensure mail logs are written to /var/log/mail.log)
            sudo systemctl restart rsyslog (save the file and restart the rsyslog service)
            sudo cat /var/log/mail.log (check if the /var/log/mail.log file now exists and contains entries)
            echo "Test mail body" | mail -s "Test Email" root (send a test email)
            sudo cat /var/log/mail.log (check again)
            sudo chmod 640 /var/log/mail.log (verify that /var/log/mail.log has correct ownership)
            sudo chown syslog:adm /var/log/mail.log (verify that /var/log/mail.log has correct permissions)
        Now that is installed, we can test the service.
          Commands for testing:
            ssh migusant@localhost -p 2222 (connect to server via ssh)
            log in to user (check that there is a message saying "You have no new mail.")
            sudo ls (while being the user, but when prompted to put password, fail once, then press CTRL+C)
            logout
            ssh migusant@localhost -p 2222 (connect again to server via ssh)
            log in to user (check that now there is a message saying "You have new mail.")
            mail (check that there is new "*** SECURITY information for migusant42 ***" and the location of it)
            cat /var/mail/migusant (check what happened: "migusant : 1 incorrect password attempt")
      Defaults        secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin" (sets the PATH environment variable for sudo commands to a secure value)
        Commands:
          su - (change to root and insert password)
          echo $PATH
        Expected Output:
          /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      Defaults        requiretty (requires sudo to be run from a terminal (TTY). This prevents scripts from running sudo commands without user interaction)
        Try running a sudo command from a non-interactive context, such as a script:
          Commands:
            ssh migusant@localhost -p 2222 "sudo ls" (this will try to run sudo without allocating a TTY (Teletypewriter))
          Expected Output:
            sudo: sorry, you must have a tty to run sudo
      Defaults        badpass_message="WRONG PASSWORD" (changes the message displayed when a user enters an incorrect password)
        Commands:
          sudo ls (while being the user, but when prompted to put password, fail once, then press CTRL+C)
        Expected Output:
          WRONG PASSWORD
      Defaults        logfile="/var/log/sudo/sudo.log" (specifies a log file where all sudo commands are recorded)
        Commands:
          sudo ls /root (while being the user, to check the content of the root directory)
          sudo tail -n 5 /var/log/sudo/sudo.log (while being the user, to check the last 5 lines of the sudo.log files)
        Expected Output: (find this two lines in the output)
          COMMAND=/usr/bin/ls /root
          COMMAND=/usr/bin/tail -n 5 /var/log/sudo/sudo.log
      Defaults        log_input (log the input of all sudo commands)
      Defaults        log_output (log the output of all sudo commands)
        Run a sudo command that has input and output:
          Command:
            sudo ls /root
            Check the the XX in "TSID=XX" and remember it for the next step (each time you run a sudo command, a unique TSID is assigned to that session)
          Expected Output: 
            The files and directories contained inside the root directory.
          Confirmation: (check the logs in /var/log/sudo/ for both input and output logs)
            su - (change to root to have access to the sudo.log file)            
            ls /var/log/sudo/00/00/XX (here we will have ttyin (the binary related to stdin_log) and ttyout (the binary related to stdout_log))
            sudo sudoreplay /var/log/sudo/00/00/XX (this will replay the session, showing both the input (commands/keystrokes) and the output (command results) as they occurred)
      Defaults        iolog_dir=/var/log/sudo
        Specifies the directory where input/output logs (log_input and log_output) are stored.
          Command:
            ls -ld /var/log/sudo (verifies that the directory exists)
          Expected Output:
           XXXXXXXXXX X root root XXXX MONTH DAY HOUR:MINUTE /var/log/sudo 
          Command:
            cat /var/log/sudo/sudo.log (as we used sudo commands before, check if they were correctly recorded in the sudo.log file)
      Defaults        passwd_tries=3
        Limits the number of incorrect password attempts for sudo to 3.
          Command:
            As user, run: sudo ls (but fail the root password 3 times)
          Expected Output:
            sudo: 3 incorrect password attempts
  If something does not work as expected or is not clearly explained, the evaluation stops here.



UFW / Firewalld
  As soon as you need help to verify a point, the evaluated person must be able to assist you:
    1.
